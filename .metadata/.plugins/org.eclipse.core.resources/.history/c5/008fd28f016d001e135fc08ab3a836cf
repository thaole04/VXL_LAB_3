/*
 * button.c
 *
 *  Created on: Oct 17, 2023
 *      Author: thao2
 */


#include "button.h"

int keyReg0[NUM_OF_BUTTONS] = {INITIAL_BUTTON_STATE, INITIAL_BUTTON_STATE, INITIAL_BUTTON_STATE};
int keyReg1[NUM_OF_BUTTONS] = {INITIAL_BUTTON_STATE, INITIAL_BUTTON_STATE, INITIAL_BUTTON_STATE};
int keyReg2[NUM_OF_BUTTONS] = {INITIAL_BUTTON_STATE, INITIAL_BUTTON_STATE, INITIAL_BUTTON_STATE};

int keyRegPast[NUM_OF_BUTTONS] = {INITIAL_BUTTON_STATE, INITIAL_BUTTON_STATE, INITIAL_BUTTON_STATE};

int timerForKeyPress = TIME_PRESS;

void keyProcessing(){
	HAL_GPIO_TogglePin(LED_RED_GPIO_Port, LED_RED_Pin);
}

void keyHoldProcessing(){
	HAL_GPIO_TogglePin(LED_RED_GPIO_Port, LED_RED_Pin);
}

void getKeyInput(){
	for (char i = 0; i < NUM_OF_BUTTONS; i++){
		keyReg0[i] = keyReg1[i];
		keyReg1[i] = keyReg2[i];
		if (i == 0) {
			keyReg2[i] = HAL_GPIO_ReadPin(BUTTON_GPIO_Port, BUTTON_Pin);
		}
		if (i == 1){
			keyReg2[i] = HAL_GPIO_ReadPin(BUTTON_GPIO_Port, BUTTON_Pin);
		}
		if (i == 2){
			keyReg2[i] = HAL_GPIO_ReadPin(BUTTON_GPIO_Port, BUTTON_Pin);
		}
		if ((keyReg0[i] == keyReg1[i]) && (keyReg1[i] == keyReg2[i])) { // stable input
			if (keyRegPast[i] != keyReg2[i]){ // press and release
				keyRegPast[i] = keyReg2[i];
				if (keyReg2[i] == BUTTON_IS_PRESSED[i]) {
					timerForKeyPress = TIME_PRESS;
					// TODO
					keyProcessing();
				}
			}else { // press and hold
				timerForKeyPress--;
				if (timerForKeyPress <= 0){
					timerForKeyPress = TIME_PRESS;
					// TODO
					if (keyReg2[i] == BUTTON_IS_PRESSED){
						keyHoldProcessing();
					}
				}
			}
		}
	}

}
